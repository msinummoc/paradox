dissolve_protectorate = {
	category = influence
	require_acceptance = no

	is_visible = {
		OR = {
			AND = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = trade_protectorate
			}
		}
	}
	is_allowed = {
	}
	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
			}
			grant_independence = yes		
		}
		else = {
			FROM = {
				grant_independence = yes
			}
		}
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = trade_protectorate
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_prestige = -1 # add_stability = -1
			}
			add_country_modifier = {
				name = dissolve_protectorate_timer
				duration = 3650
				hidden = yes
			}
		}
		else_if = {
			limit = {
				FROM = {
					NOT = { liberty_desire = 100 }
				}
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_prestige = -1 # add_stability = -1
			}
			FROM = {
				add_country_modifier = {
					name = dissolve_protectorate_timer
					duration = 3650
					hidden = yes
				}
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}